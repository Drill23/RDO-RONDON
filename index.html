
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visualizador Diário</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
      background-color: #f2f2f2;
    }
    .conteudo {
      margin-top: 20px;
    }
    iframe, img {
      max-width: 90%;
      height: 80vh;
      border: 2px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    table {
      margin: auto;
      width: 95%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
    }
    th {
      background-color: #e0e0e0;
    }
    .positivo {
      color: green;
      font-weight: bold;
    }
    .negativo {
      color: red;
      font-weight: bold;
    }
    .login {
      margin-top: 40px;
    }
    #uploadArea {
      display: none;
      margin-top: 30px;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .destaque {
      font-weight: bold;
      color: #333;
    }
  </style>
</head>
<body>
  <h1>Visualizador Diário de Arquivos</h1>
  <p>Veja abaixo o conteúdo mais recente publicado:</p>

  <div class="conteudo" id="conteudo">
    <p>Carregando conteúdo...</p>
  </div>

  <div class="login">
    <button onclick="solicitarSenha()">Acesso Privado</button>
  </div>

  <div id="uploadArea">
    <h3>Área Privada - Instruções de Upload</h3>
    <p>1. Acesse o repositório no GitHub.</p>
    <p>2. Clique em <span class="destaque">"Add file" > "Upload files"</span>.</p>
    <p>3. Envie um novo arquivo com o nome <span class="destaque">"atual.pdf"</span>, <span class="destaque">"atual.png"</span> ou <span class="destaque">"atual.json"</span>.</p>
    <p>4. Confirme o upload e clique em <span class="destaque">"Commit changes"</span>.</p>
    <p>5. O novo conteúdo será exibido automaticamente para todos que acessarem o link.</p>
  </div>

  <script>
    async function verificarArquivo(nome) {
      try {
        const res = await fetch(nome, { method: 'HEAD' });
        return res.ok;
      } catch {
        return false;
      }
    }

    async function carregarConteudo() {
      const div = document.getElementById('conteudo');

      const existeJSON = await verificarArquivo('atual.json');
      const existePDF = await verificarArquivo('atual.pdf');
      const existePNG = await verificarArquivo('atual.png');

      if (existeJSON) {
        const res = await fetch('atual.json');
        const dados = await res.json();

        let html = `
          <table>
            <tr>
              <th>Produto</th>
              <th>Meta (%)</th>
              <th>Realizado (%)</th>
              <th>Diferença (%)</th>
              <th>Meta Atingida</th>
              <th>Quilos</th>
              <th>Caixas</th>
            </tr>`;

        for (let item of dados) {
          let diff = parseFloat(item.diferencaPercentual);
          let classe = diff >= 0 ? 'positivo' : 'negativo';
          let atingiu = item.atingiuMeta ? '✅' : '❌';

          html += `
            <tr>
              <td>${item.produto}</td>
              <td>${item.meta.toFixed(2)}</td>
              <td>${item.realizado.toFixed(3)}</td>
              <td class="${classe}">${diff > 0 ? '+' : ''}${item.diferencaPercentual}</td>
              <td>${atingiu}</td>
              <td>${item.quilos.toFixed(2)}</td>
              <td>${item.caixas.toFixed(2)}</td>
            </tr>`;
        }

        html += '</table>';
        div.innerHTML = html;
      } else if (existePDF) {
        div.innerHTML = `<iframe src="atual.pdf" frameborder="0"></iframe>`;
      } else if (existePNG) {
        div.innerHTML = `<img src="atual.png" alt="Imagem do Dia">`;
      } else {
        div.innerHTML = `<p>Nenhum arquivo disponível no momento.</p>`;
      }
    }

    function solicitarSenha() {
      const senha = prompt("Digite a senha de acesso:");
      if (senha === "admin123") {
        document.getElementById('uploadArea').style.display = 'block';
      } else {
        alert("Senha incorreta.");
      }
    }

    carregarConteudo();
  </script>
</body>
</html>
